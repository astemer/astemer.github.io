var b=null,e=0,g=0,h={x:0,y:0},l={h:{angle:0,a:0},i:0,f:{b:0,c:0},g:{b:0,c:0}},m,n,p,q=[{x:0,y:0}],r=0,t=!0;function u(a){switch(a.code){case a.PERMISSION_DENIED:alert("User did not share geolocation data");break;case a.POSITION_UNAVAILABLE:alert("Could not detect current position");break;case a.TIMEOUT:alert("Retrieving position timedout");break;default:alert("Unknown error")}}
function v(a){var c=a.coords.latitude,d=a.coords.longitude;e=c;g=d;a={x:0,y:0};c=w(c,d);angleDelta=l.h.angle-c.angle;angle=l.h.angle-angleDelta;dist=c.a*l.i;a.x=Math.cos(angle)*dist;a.y=Math.sin(angle)*dist;h=a;document.getElementById("current_location").value=e+", "+g;t=h.x>n.width||0>h.x||h.y>n.height||0>h.y?!1:!0;dist=x(h.x,h.y,q[q.length-1].x,q[q.length-1].y);dist>m&&q.push({x:h.x,y:h.y});1E3<q.length&&q.shift()}function y(a){p.beginPath();p.arc(a.x,a.y,3,0,2*Math.PI);p.stroke()}
function z(){p.clearRect(0,0,n.width,n.height);p.beginPath();p.closePath();p.drawImage(map_image,0,0,map_image.width,map_image.height,0,0,n.width,n.height);p.lineWidth=1;p.strokeStyle="red";q.forEach(y);var a=h.x,c=h.y;if(0!=a||0!=c){var d=30;0==r%2&&(d-=d/4);var f=2*d/3,k=d/3;p.beginPath();p.lineWidth=5;p.strokeStyle="red";p.arc(a,c,d-k,0,2*Math.PI);p.moveTo(a-d,c);p.lineTo(a-d+f,c);p.moveTo(a+d,c);p.lineTo(a+d-f,c);p.moveTo(a,c-d,a);p.lineTo(a,c-d+f);p.moveTo(a,c+d);p.lineTo(a,c+d-f);p.stroke();
p.beginPath();p.lineWidth=2;p.strokeStyle="white";p.arc(a,c,d-k,0,2*Math.PI);p.moveTo(a-d,c);p.lineTo(a-d+f,c);p.moveTo(a+d,c);p.lineTo(a+d-f,c);p.moveTo(a,c-d,a);p.lineTo(a,c-d+f);p.moveTo(a,c+d);p.lineTo(a,c+d-f);p.stroke()}1!=t&&(p.strokeStyle=0==r%4?"white":"red",p.font="30px Arial",p.strokeText("You are not located on this map...",20,60))}function A(){r+=1;1E5<r&&(r=0);z()}function x(a,c,d,f){a=d-a;c=f-c;return Math.sqrt(a*a+c*c)}
function w(a,c){var d=l.f.b,f=l.f.c,k={angle:0,a:0};k.a=B(d,f,a,c);var C=k.a;d=B(d,f,a,f);k.angle=Math.asin(d/C);JSON.stringify(k);return k}function B(a,c,d,f){var k=Math.PI/180*(d-a);c=Math.PI/180*(f-c);a=Math.sin(k/2)*Math.sin(k/2)+Math.cos(Math.PI/180*a)*Math.cos(Math.PI/180*d)*Math.sin(c/2)*Math.sin(c/2);return 12742*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}var D=window;document.getElementById("current_location").value="Loading...";
document.getElementById("map_title").innerHTML="undefined"===typeof mapTitle?"Your location map":mapTitle;l.f.b=dataJson.j;l.f.c=dataJson.l;l.g.b=dataJson.m;l.g.c=dataJson.o;n=document.getElementById("map_canvas");p=n.getContext("2d");map_image=new Image;map_image.src="img.jpg";
map_image.onload=function(){var a=map_image.width/map_image.height;n.width=window.innerWidth;n.height=n.width/a;p.drawImage(map_image,0,0,map_image.width,map_image.height,0,0,n.width,n.height);l.h=w(l.g.b,l.g.c);a=x(0,0,n.width,n.height);l.i=a/l.h.a;JSON.stringify(l);m=a/250;null==b&&(b=navigator.geolocation.watchPosition(v,u,{timeout:1E4,enableHighAccuracy:!0,maximumAge:Infinity}));setInterval(A,500)};n.addEventListener("mousedown",function(){n.getBoundingClientRect();z()},!1);
n.addEventListener("touchstart",function(){n.getBoundingClientRect();z()},!1);D.onload=void 0;